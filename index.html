<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ابزار حسابداری آنلاین شاپ</title>
    <link rel="manifest" href="/firouzeh_assistant/manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="main.css/style.css">
    <link rel="stylesheet" href="main.css/foter.css">
</head>

<body>
    <header class="app-header">
        <button class="header-icon left-icon" title="خرید اشتراک">
            <i class="fas fa-shopping-cart"></i>
        </button>

        <div class="logo-container">
            <div class="logo"></div>
            <div class="app-name">ابزار حسابداری</div>
        </div>

        <button class="header-icon right-icon" title="تنظیمات">
            <i class="fas fa-cog"></i>
        </button>
    </header>
    <main>
        <div class="search-box">
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input" placeholder="جستجو در سفارش‌ها، محصولات، مشتریان..."
                    autocomplete="off">
            </div>
            <!--باکس اول خلاصه سفارش  -->
            <div class="sales-card">

                <div class="sales-header">
                    <div class="title">
                        خلاصه فروش
                    </div>

                    <select id="timeFrame" onchange="updateChart()">
                        <option value="monthly" selected>ماهانه</option>
                        <option value="weekly">هفتگی</option>
                        <option value="daily">روزانه</option>
                        <option value="yearly">سالانه</option>
                    </select>
                </div>

                <div class="stats-row">
                    <div class="stat">
                        <div class="value">1,500,000</div>
                        <div class="label">فروش کل (تومان)</div>
                    </div>
                    <div class="stat">
                        <div class="value profit">500,000</div>
                        <div class="label">سود کل (تومان)</div>
                    </div>
                    <div class="stat">
                        <div class="value">150</div>
                        <div class="label">تعداد سفارش</div>
                    </div>
                </div>

                <div class="separator"></div>

                <div class="top-products">
                    <div class="section-title">۳ محصول پرفروش</div>

                    <div class="products-row">
                        <div class="product">
                            <div class="name">پیراشکی</div>
                            <div class="count">42 عدد</div>
                        </div>
                        <div class="product">
                            <div class="name">کیک</div>
                            <div class="count">35 عدد</div>
                        </div>
                        <div class="product">
                            <div class="name">دونات</div>
                            <div class="count">28 عدد</div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- باکس جدید برای نمودار -->
            <div class="chart-container">
                <div class="chart-header">
                    <h3 class="chart-title">نمودار فروش و سود</h3>
                    <div class="time-selector">
                        <select id="timeFrame" onchange="updateChart()">
                            <option value="monthly" selected>ماهانه</option>
                            <option value="weekly">هفتگی</option>
                            <option value="daily">روزانه</option>
                            <option value="yearly">سالانه</option>
                        </select>
                        <i class="fas fa-calendar-alt"></i> <!-- آیکون تقویم برای تغییر زمان -->
                    </div>
                </div>
                <canvas id="salesChart"></canvas>
            </div>

            <!-- Floating Action Menu -->
<div class="fab-container">
    <button class="fab main-fab" id="fab-toggle" aria-label="منوی اقدامات سریع">
        <i class="fas fa-plus"></i>
    </button>

    <div class="fab-menu" id="fab-menu">
        <a href="create_order.html">
            <button class="fab-item" data-action="new-order">
                <span>ثبت سفارش</span>
                <i class="fas fa-shopping-cart"></i>
            </button>
        </a>

        <a href="add_product.html">
            <button class="fab-item" data-action="new-product">
                <span>ثبت محصول</span>
                <i class="fas fa-box"></i>
            </button>
        </a>

        <a href="your_expense_page.html">
            <button class="fab-item" data-action="new-expense">
                <span>ثبت هزینه</span>
                <i class="fas fa-money-bill-wave"></i>
            </button>
        </a>
    </div>
</div>

            <!-- Overlay (برای بلور و تاریک کردن پس‌زمینه) -->
            <div class="fab-overlay" id="fab-overlay"></div>
    </main>
    <footer class="bottom-nav">
    <a href="costs.html"> <!-- اگر صفحه هزینه‌ها داری، href رو درست کن -->
        <div class="nav-item" data-page="costs" onclick="navigate('costs', this)">
            <i class="fas fa-money-bill-wave"></i>
            <span>هزینه‌ها</span>
            <div class="indicator"></div>
        </div>
    </a>

    <a href="pending_orders.html">
        <div class="nav-item" data-page="orders" onclick="navigate('orders', this)">
            <i class="fas fa-box-open"></i>
            <span>سفارش‌ها</span>
            <div class="indicator"></div>
        </div>
    </a>

    <!-- خانه همیشه فعاله -->
    <a href="index.html">
        <div class="nav-item nav-home active" data-page="home" onclick="navigate('home', this)">
            <div class="home-circle">
                <i class="fas fa-home"></i>
            </div>
            <span>خانه</span>
            <div class="indicator"></div>
        </div>
    </a>

    <a href="inventory.html">
        <div class="nav-item" data-page="inventory" onclick="navigate('inventory', this)">
            <i class="fas fa-warehouse"></i>
            <span>انبار</span>
            <div class="indicator"></div>
        </div>
    </a>

    <a href="reports.html">
        <div class="nav-item" data-page="reports" onclick="navigate('reports', this)">
            <i class="fas fa-chart-bar"></i>
            <span>گزارشات</span>
            <div class="indicator"></div>
        </div>
    </a>
</footer>


    <script>
        function navigate(page, element) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            element.classList.add('active');

            console.log("navigate to:", page);
        }
        // داده‌های نمونه برای تایم‌فریم‌های مختلف (می‌تونی واقعی جایگزین کنی)
        const dataSets = {
            monthly: {
                labels: ['فروردین', 'اردیبهشت', 'خرداد', 'تیر', 'مرداد', 'شهریور', 'مهر', 'آبان', 'آذر', 'دی', 'بهمن', 'اسفند'],
                sales: [1200000, 1500000, 1800000, 1400000, 1600000, 1900000, 1700000, 2000000, 2100000, 1800000, 2200000, 2500000],
                profit: [400000, 500000, 600000, 450000, 550000, 650000, 550000, 700000, 750000, 600000, 800000, 900000]
            },
            weekly: {
                labels: ['هفته 1', 'هفته 2', 'هفته 3', 'هفته 4'],
                sales: [300000, 400000, 350000, 450000],
                profit: [100000, 150000, 120000, 180000]
            },
            daily: {
                labels: ['روز 1', 'روز 2', 'روز 3', 'روز 4', 'روز 5', 'روز 6', 'روز 7'],
                sales: [50000, 60000, 55000, 70000, 65000, 80000, 75000],
                profit: [15000, 20000, 18000, 25000, 22000, 30000, 28000]
            },
            yearly: {
                labels: ['1400', '1401', '1402', '1403', '1404'],
                sales: [10000000, 12000000, 15000000, 18000000, 20000000],
                profit: [3000000, 4000000, 5000000, 6000000, 7000000]
            }
        };

        // ایجاد چارت اولیه
        let chartInstance = null;

        function updateChart() {
            const timeFrame = document.getElementById('timeFrame').value;
            const data = dataSets[timeFrame];

            // خواندن رنگ از CSS variable
            const secondaryColor = getComputedStyle(document.documentElement)
                .getPropertyValue('--secondary-color').trim();

            if (chartInstance) {
                chartInstance.destroy();
            }

            const ctx = document.getElementById('salesChart').getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'line', // منحنی (line chart)
                data: {
                    labels: data.labels, // محور افقی: روزها/هفته‌ها/ماه‌ها/سال‌ها
                    datasets: [
                        {
                            label: 'فروش کل',
                            data: data.sales,
                            borderColor: secondaryColor,
                            backgroundColor: 'rgba(0, 121, 107, 0.2)',
                            fill: true,
                            tension: 0.4 // برای منحنی نرم
                        },
                        {
                            label: 'سود کل',
                            data: data.profit,
                            borderColor: '#388e3c', // رنگ سبز برای سود
                            backgroundColor: 'rgba(56, 142, 60, 0.2)',
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'مبلغ (تومان)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'زمان'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        // فراخوانی اولیه با دیفالت ماهانه
        window.onload = updateChart;

        // فقط این اسکریپت کوچک را اضافه کن (می‌تونی در <script> انتهای body بگذاری)

        const toggleBtn = document.getElementById('fab-toggle');
        const menu = document.getElementById('fab-menu');
        const overlay = document.getElementById('fab-overlay');

        function toggleFab() {
            toggleBtn.classList.toggle('open');
            menu.classList.toggle('open');
            overlay.classList.toggle('open');
        }

        toggleBtn.addEventListener('click', toggleFab);

        // بستن با کلیک روی overlay
        overlay.addEventListener('click', toggleFab);

        // عملکرد هر دکمه (placeholder – بعداً جایگزین کن)
        document.querySelectorAll('.fab-item').forEach(btn => {
            btn.addEventListener('click', () => {
                const action = btn.dataset.action;

                if (action === 'new-order') {
                    alert('ثبت سفارش جدید');
                    // یا: window.location.href = '/new-order.html';
                } else if (action === 'new-product') {
                    alert('ثبت محصول جدید');
                } else if (action === 'new-expense') {
                    alert('ثبت هزینه جدید');
                }

                // بعد از کلیک، منو بسته شود
                toggleFab();
            });
        });
        //اینم برا همون فایل سی وی هست که باید برا تمام فیال ها توی قسمت اسکریپت اضافه بشه 
        if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/firouzeh_assistant/sw.js')
        .then(reg => console.log('Service Worker ثبت شد!', reg))
        .catch(err => console.log('خطا:', err));
    });
  }

  // چک کن توکن هست یا نه
    document.addEventListener('DOMContentLoaded', function() {
        const token = localStorage.getItem('access_token');
        console.log('Token in dashboard:', token ? 'دارم' : 'ندارم');
        
        if (!token) {
            // اگه توکن نبود، برو به صفحه لاگین
            window.location.href = 'login.html';
        }
    });

// نمایش توکن برای دیباگ
    document.addEventListener('DOMContentLoaded', function() {
        const token = localStorage.getItem('access_token');
        console.log('Dashboard - Token exists:', !!token);
        if (token) {
            console.log('Token preview:', token.substring(0, 20) + '...');
        } else {
            console.log('No token found!');
        }
    });
    </script>
</body>

</html>